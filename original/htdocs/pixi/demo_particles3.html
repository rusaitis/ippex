<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>PIXI DEMO</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000000;
        }

        .rendererView {
            position: absolute;
            display: block;
            height: 100%;
        }
        canvas {
          position: absolute;
      }
    </style>
    <link rel="stylesheet" href="../bower_components/katex/dist/katex.min.css">
    <script src="../bower_components/katex/dist/katex.min.js"></script>
</head>

<body>

    <div id="container"></div>
    <!-- // <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> -->
    <!-- // <script src="//cdnjs.cloudflare.com/ajax/libs/pixi.js/1.5.3/pixi.js"></script> -->
    <script src="../js/TweenMax.min.js"></script>
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../bower_components/pixi/bin/pixi.min.js"></script>
    <!-- // <script src="js/jquery.mobile-1.4.5.min.js"></script> -->
    <!-- // <script src="../js/konva.min.js"></script> -->
    <script src="../js/ui.js"></script>
    <!-- // <script src="../js/math.js"></script> -->
    <!-- // <script src="js/ui.js"></script> -->
    <!-- // <script src="js/slider.js"></script> -->
    <!-- // <script src="js/button.js"></script> -->
    <script defer="defer">

//==============================================================================
//                                  START
//==============================================================================

// ‥‥‥‥‥‥‥‥‥‥‥‥‥□□□
// ‥‥‥‥‥‥〓〓〓〓〓‥‥□□□
// ‥‥‥‥‥〓〓〓〓〓〓〓〓〓□□
// ‥‥‥‥‥■■■□□■□‥■■■
// ‥‥‥‥■□■□□□■□□■■■
// ‥‥‥‥■□■■□□□■□□□■
// ‥‥‥‥■■□□□□■■■■■‥
// ‥‥‥‥‥‥□□□□□□□■‥‥
// ‥‥■■■■■〓■■■〓■‥‥‥
// ‥■■■■■■■〓■■■〓‥‥■
// □□■■■■■■〓〓〓〓〓‥‥■
// □□□‥〓〓■〓〓□〓〓□〓■■
// ‥□‥■〓〓〓〓〓〓〓〓〓〓■■
// ‥‥■■■〓〓〓〓〓〓〓〓〓■■
// ‥■■■〓〓〓〓〓〓〓‥‥‥‥‥
// ‥■‥‥〓〓〓〓‥‥‥‥‥‥‥‥
var dataSet = [
    "BK","BK","BK","BK","BK","BK","BK","BK","BK","BK","BK","BK","BK","BG","BG","BG",
    "BK","BK","BK","BK","BK","BK","RD","RD","RD","RD","RD","BK","BK","BG","BG","BG",
    "BK","BK","BK","BK","BK","RD","RD","RD","RD","RD","RD","RD","RD","RD","BG","BG",
    "BK","BK","BK","BK","BK","BR","BR","BR","BG","BG","BR","BG","BK","RD","RD","RD",
    "BK","BK","BK","BK","BR","BG","BR","BG","BG","BG","BR","BG","BG","RD","RD","RD",
    "BK","BK","BK","BK","BR","BG","BR","BR","BG","BG","BG","BR","BG","BG","BG","RD",
    "BK","BK","BK","BK","BR","BR","BG","BG","BG","BG","BR","BR","BR","BR","RD","BK",
    "BK","BK","BK","BK","BK","BK","BG","BG","BG","BG","BG","BG","BG","RD","BK","BK",
    "BK","BK","RD","RD","RD","RD","RD","BL","RD","RD","RD","BL","RD","BK","BK","BK",
    "BK","RD","RD","RD","RD","RD","RD","RD","BL","RD","RD","RD","BL","BK","BK","BR",
    "BG","BG","RD","RD","RD","RD","RD","RD","BL","BL","BL","BL","BL","BK","BK","BR",
    "BG","BG","BG","BK","BL","BL","RD","BL","BL","YL","BL","BL","YL","BL","BR","BR",
    "BK","BG","BK","BR","BL","BL","BL","BL","BL","BL","BL","BL","BL","BL","BR","BR",
    "BK","BK","BR","BR","BR","BL","BL","BL","BL","BL","BL","BL","BL","BL","BR","BR",
    "BK","BR","BR","BR","BL","BL","BL","BL","BL","BL","BL","BK","BK","BK","BK","BK",
    "BK","BR","BK","BK","BL","BL","BL","BL","BK","BK","BK","BK","BK","BK","BK","BK"
];

function getRgbColor( colorType, baseColor )
{
    var colorHash = {
        "BK":"#000000", // black
        "WH":"#FFFFFF", // white
        "BG":"#FFCCCC", // beige
        "BR":"#800000", // brown
        "RD":"#FF0000", // red
        "YL":"#FFFF00", // yellow
        "GN":"#00FF00", // green
        "WT":"#00FFFF", // water
        "BL":"#0000FF", // blue
        "PR":"#800080"  // purple
    };

    if ( colorType == "RD" || colorType == "BL" ) {
        return colorHash[ baseColor ];
    } else {
        return colorHash[ colorType ];
    }
}

function getSingleLightColor(colorType, baseColor, rgbType) {
    var result = "";

    var rgb = getRgbColor(colorType, baseColor);
    rgb = rgb.replace("#", "");
    var r = parseInt("0x" + rgb.substr(0, 2), 16);
    var g = parseInt("0x" + rgb.substr(2, 2), 16);
    var b = parseInt("0x" + rgb.substr(4, 2), 16);

    switch (rgbType) {
        case 'r':
            result = r;
            break;
        case 'g':
            result = g;
            break;
        case 'b':
            result = b;
            break;
    }
    return result;
}

var stage, renderer, stageWidth, stageHeight;
var particleTextures = [];
var particles, changing;
var mousex, mousey;

// See:
//   Stopping Infinite Loops
//   http://codepen.io/quezo/javascriptn/stopping-infinite-loops

//var TOTAL = 30000;
var TOTAL = 3000;

function getDataURL(baseColor) {
    var canvas = document.createElement("canvas");
    canvas.width = 16;
    canvas.height = 16;
    var ctx = canvas.getContext("2d");
    var image = ctx.createImageData(16, 16);
    for (var i = 0; i < image.data.length; i += 4) {
        if (dataSet[i / 4] != "BK") {
            image.data[i] = getSingleLightColor(dataSet[i / 4], baseColor, "r");
            image.data[i + 1] = getSingleLightColor(dataSet[i / 4], baseColor, "g");
            image.data[i + 2] = getSingleLightColor(dataSet[i / 4], baseColor, "b");
            image.data[i + 3] = 255;
        }
    }
    ctx.putImageData(image, 0, 0);
    var dataURL = canvas.toDataURL();
    return dataURL;
}

var colors = ["WH", "BG", "BR", "RD", "YL", "GN", "WT", "BL", "PR"];

function init() {
    // dimension
    stageWidth = window.innerWidth;
    stageHeight = window.innerHeight;
    mousex = stageWidth / 2;
    mousey = stageHeight / 2;

    // renderer
    renderer = PIXI.autoDetectRenderer(stageWidth, stageHeight);
    document.body.appendChild(renderer.view);
    stage = new PIXI.Stage();

    // particles
    for (var i = 0; i < colors.length; i++) {
        var dataURL = getDataURL(colors[i]);
        var particleTexture = new PIXI.Texture.fromImage(dataURL);
        particleTextures.push(particleTexture);
    }

    particles = [];
    changing = false;

    // remove all particles from stage
    function removeAllBalls() {
        var len = particles.length;
        for (i = 0; i < len; i++) {
            var old = particles[i].sprite;
            stage.removeChild(old);
        }

        particles = [];
        renderer.render(stage);
    }

    // add particles on stage
    function addParticles() {
        removeAllBalls();

        for (i = 0; i < TOTAL; i++) {
            var ball = new PIXI.Sprite(particleTextures[Math.floor(20 * i / TOTAL * colors.length) % colors.length]);
            ball.anchor.x = 0.5;
            ball.anchor.y = 0.5;
            ball.vx = 0;
            ball.vy = 0;
            ball.position.x = Math.random() * stageWidth;
            ball.position.y = Math.random() * stageHeight;
            stage.addChild(ball);

            particles.push({
                sprite: ball,
                vx: 0,
                vy: 0
            });
        }
    }

    // mouse move
    function moveHandler(event) {
        mousex = event.clientX;
        mousey = event.clientY;
    }
    document.body.onmousemove = moveHandler;

    // go!
    addParticles();

    // animate
    requestAnimFrame(tick);
}

function tick() {
    if (changing) return;

    for (var i = 0; i < TOTAL; i++) {
        var ball = particles[i].sprite;
        var dx = ball.position.x - mousex;
        var dy = ball.position.y - mousey;
        var vx = particles[i].vx;
        var vy = particles[i].vy;

        if (dx * dx + dy * dy <= 10000) {
            vx += dx * 0.01;
            vy += dy * 0.01;
        }
        vx *= 0.95;
        vy *= 0.95;

        vx += Math.random() - 0.5;
        vy += Math.random() - 0.5;

        var x = ball.position.x += vx;
        var y = ball.position.y += vy;

        if (x < 0 || x > stageWidth || y < 0 || y > stageHeight) {
            var r = Math.atan2(y - stageHeight / 2, x - stageWidth / 2);
            vx = -Math.cos(r);
            vy = -Math.sin(r);
        }

        particles[i].vx = vx;
        particles[i].vy = vy;
    }

    renderer.render(stage);

    requestAnimFrame(tick);
}

// Init
window.addEventListener('load', init, false);

//==============================================================================
//                                     END
//==============================================================================

    </script>

</body>

</html>