/**
* The MIT License (MIT)

* Copyright (c) 2014 Sebastian Nette

* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
* THE SOFTWARE.
*
* 
*
*/

/**
 * PIXI Input Element v1.0.1
 * Copyright (c) 2014, Sebastian Nette
 * http://www.mokgames.com/
 */
!function(t){function e(){}function i(e){return e.value!==t?"value":e.text!==t?"text":e.textContent!==t?"textContent":"innerText"}function s(t,e,i){t[e]=i}function a(t,e){return t[e].replace(/\r/g,"")}function h(t){return!("object"!=typeof t||!t||t instanceof Array)}function n(t){var e=f[t]
if(!e){var i=document.createElement("canvas")
i.width=2,i.height=2
var s=i.getContext("2d")
s.fillStyle=t,s.fillRect(0,0,2,2),e=PIXI.Texture.fromCanvas(i),f[t]=e}return e}function o(t,e,i){for(var s in e)if(i)t[s]=e[s]
else{var a=h(e[s])
t.hasOwnProperty(s)||(t[s]=a?{}:e[s]),a&&(h(t[s])||(t[s]={}),o(t[s],e[s]))}return t}function d(t){return t._isBitmapFont?t._lineHeight:c||t.determineFontHeight?t.determineFontHeight("font: "+t.style.font+";")+t.style.strokeThickness:parseInt(t.determineFontProperties(t.style.font).fontSize,10)+t.style.strokeThickness}function u(e,i,s,a,h,n){if(n instanceof Array)var o=n[0],d=n[1],r=n[2],c=n[3]
else var o=n,d=n,r=n,c=n
return 2*o>a||2*o>h?u(e,i,s,a||1,h||1,0):(e.beginPath(),e.moveTo(i+o,s),e.lineTo(i+a-d,s),e.quadraticCurveTo(i+a,s,i+a,s+d),e.lineTo(i+a,s+h-r),e.quadraticCurveTo(i+a,s+h,i+a-r,s+h),e.lineTo(i+c,s+h),e.quadraticCurveTo(i,s+h,i,s+h-c),e.lineTo(i,s+o),e.quadraticCurveTo(i,s,i+o,s),e.closePath(),t)}function r(t,e){var i=e?t.boxShadow:t.innerShadow
if(i&&"none"!==i){var s=i.split("px ")
i={x:parseInt(s[0],10),y:parseInt(s[1],10),blur:parseInt(s[2],10),color:s[3]}}else i={x:0,y:0,blur:0,color:""}
return e&&(i.x<0?(t.shadowLeft=Math.abs(i.x)+i.blur,t.shadowRight=i.blur+i.x):(t.shadowLeft=Math.abs(i.blur-i.x),t.shadowRight=i.blur+i.x),i.y<0?(t.shadowTop=Math.abs(i.y)+i.blur,t.shadowBottom=i.blur+i.y):(t.shadowTop=Math.abs(i.blur-i.y),t.shadowBottom=i.blur+i.y),t.shadowWidth=t.shadowLeft+t.shadowRight,t.shadowHeight=t.shadowTop+t.shadowBottom),i}var c=-1!==PIXI.VERSION.indexOf("v1"),l=navigator&&navigator.isCocoonJS,p=t!==window.orientation,I=300,x={readonly:!1,maxlength:null,placeholder:"",placeholderColor:"#bfbebd",placeholderAlign:"",selectionColor:"rgba(179, 212, 253, 0.8)",selectionUpdated:!1,selectionStart:-1,value:"",type:"text",onsubmit:e,onkeydown:e,onkeyup:e,onfocus:e,onblur:e,onmousedown:e,onmouseup:e,cursorPos:0,hasFocus:!1,mouseDown:!1},b={width:170,height:null,padding:5,borderColor:"#000",borderWidth:1,borderRadius:3,backgroundImage:null,backgroundColor:"#fff",backgroundGradient:null,boxShadow:"1px 1px 0px rgba(0, 0, 0, 0.1)",innerShadow:"0px 0px 4px rgba(0, 0, 0, 0.4)",valign:"middle",align:"center",outline:0,text:{font:"14px Arial",fill:"#000",align:"left",stroke:"#000",strokeThickness:0}},f={},g=document.createElement("canvas"),P=g.getContext("2d"),v=document.createElement("canvas"),m=v.getContext("2d")
PIXI.ButtonFactory=function(t,e,i){h(i.boxShadow)||(i.boxShadow=r(i,!0),i.outerWidth=i.width+2*i.padding+2*i.borderWidth+i.shadowWidth,i.outerHeight=i.height+2*i.padding+2*i.borderWidth+i.shadowHeight),h(i.innerShadow)||(i.innerShadow=r(i,!1))
var s=i.outerWidth||i.width||100,a=i.outerHeight||i.height||30,n=i.borderRadius,o=i.borderWidth,d=i.shadowWidth,c=i.shadowHeight,p=i.shadowLeft,I=i.shadowTop
t.width=s,t.height=a,l&&e.clearRect(0,0,s,a),e.shadowOffsetX=i.boxShadow.x,e.shadowOffsetY=i.boxShadow.y,e.shadowBlur=i.boxShadow.blur,e.shadowColor=i.boxShadow.color,i.borderWidth>0&&(e.fillStyle=i.borderColor,u(e,p,I,s-d,a-c,n),e.fill(),e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0)
var x=i.textboxHeight=a-2*o-c,b=i.textboxTop=o+I,f=i.textboxWidth=s-2*o-d,v=i.textboxLeft=o+p
if(!i.bgImage&&i.backgroundImage&&(i.bgImage=PIXI.Texture.fromImage(i.backgroundImage),i.bgImage.baseTexture.hasLoaded?i.dirty=!0:i.bgImage.on("update",function(){i.dirty=!0})),i.bgImage&&i.backgroundImage&&i.bgImage.baseTexture.hasLoaded)e.drawImage(i.bgImage,0,0,i.bgImage.width,i.bgImage.height,v,b,f,x)
else{if(i.backgroundGradient&&!h(i.backgroundColor)){var m=i.backgroundGradient.length
if(2>m)return
i.backgroundColor=e.createLinearGradient(0,0,0,a)
for(var y=0;m>y;y++){var w=i.backgroundGradient[y]
2===w.length?i.backgroundColor.addColorStop(w[0],w[1]):i.backgroundColor.addColorStop(y/(m-1),w)}}e.fillStyle=i.backgroundColor,u(e,v,b,f,x,n),e.fill()}e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0
var O=i.innerShadow
O.blur>0&&(g.width=i.width+2*i.padding,g.height=i.height+2*i.padding,P.shadowBlur=O.blur,P.shadowColor=O.color,P.shadowOffsetX=0,P.shadowOffsetY=O.y,P.fillRect(-1*s,-100,3*s,100),P.shadowOffsetX=O.x,P.shadowOffsetY=0,P.fillRect(g.width,-1*a,100,3*a),P.shadowOffsetX=0,P.shadowOffsetY=O.y,P.fillRect(-1*s,g.height,3*s,100),P.shadowOffsetX=O.x,P.shadowOffsetY=0,P.fillRect(-100,-1*a,100,3*a),u(e,o+p,o+I,s-2*o-d,a-2*o-c,n),e.clip(),e.drawImage(g,0,0,g.width,g.height,o+p,o+I,g.width,g.height))},PIXI.InputObject=function(e){if(this.tabIndex=e!==t?e:PIXI.InputObject.tabIndex++,PIXI.Sprite.call(this,PIXI.Texture.fromCanvas(this.canvas)),PIXI.InputObject.inputs.push(this),this.resolution=1,!l){if(!PIXI.InputObject.hiddenInput){var s=document.createElement("input")
s.type="text",s.tabindex=-1,s.style.position="fixed",s.style.opacity=0,s.style.pointerEvents="none",s.style.left="0px",s.style.bottom="0px",s.style.left="-100px",s.style.top="-100px",s.style.zIndex=10,s.addEventListener("blur",function(){PIXI.InputObject.currentInput&&PIXI.InputObject.currentInput.onMouseUpOutside()},!1),s.addEventListener("keydown",function(t){PIXI.InputObject.currentInput&&(t=t||window.event,PIXI.InputObject.currentInput.data.hasFocus&&PIXI.InputObject.currentInput.onKeyDown(t))}),s.addEventListener("keyup",function(t){PIXI.InputObject.currentInput&&(t=t||window.event,PIXI.InputObject.currentInput.data.hasFocus&&PIXI.InputObject.currentInput.onKeyUp(t))}),document.body.appendChild(s),PIXI.InputObject.textProp=i(s),PIXI.InputObject.hiddenInput=s}this.hiddenInput=PIXI.InputObject.hiddenInput}this._textNeedsUpdate=!0,this.data.dirty=!0,this.update()},PIXI.InputObject.prototype=Object.create(PIXI.Sprite.prototype),PIXI.InputObject.prototype.constructor=PIXI.InputObject,o(PIXI.InputObject.prototype,{updateData:function(t){t.hasOwnProperty("text")&&(this._textStyleNeedsUpdate=!0),this.data=o(t,this.data),this.data.dirty=!0,(t.hasOwnProperty("value")||this._textStyleNeedsUpdate)&&(this._textNeedsUpdate=!0)},focus:function(){PIXI.InputObject.currentInput!==this&&(PIXI.InputObject.currentInput&&PIXI.InputObject.currentInput.blur(),PIXI.InputObject.currentInput=this,this.data.hasFocus=!0,this.data.onfocus(),this.data.readonly||this.hiddenInput.focus())},blur:function(){PIXI.InputObject.currentInput===this&&(PIXI.InputObject.currentInput=null,this.data.hasFocus=!1,this.hiddenInput.blur(),this.data.onblur())},onKeyUp:function(){},onKeyDown:function(){},onClick:function(){},onMouseMove:function(){},onMouseDown:function(){},onMouseUp:function(){},onMouseUpOutside:function(){this.data.hasFocus&&!this.data.mouseDown&&this.blur(),this.data.mouseDown=!1},updateTexture:function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.crop.width=this.texture.frame.width=this.canvas.width,this.texture.crop.height=this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,c?this.requiresUpdate=!0:this.texture.baseTexture.dirty()},_renderWebGL:function(t){c?this.requiresUpdate&&(this.requiresUpdate=!1,PIXI.updateWebGLTexture(this.texture.baseTexture,t.gl)):(this.resolution=t.resolution,this.texture.baseTexture.resolution=this.resolution),PIXI.Sprite.prototype._renderWebGL.call(this,t)},destroy:function(){this.interactive=!1,this.context=null,this.canvas=null,this.texture.destroy(!0),PIXI.InputObject.inputs.splice(PIXI.InputObject.inputs.indexOf(this),1)}},!0),Object.defineProperty(PIXI.InputObject.prototype,"width",{get:function(){return this.update(),this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(PIXI.InputObject.prototype,"height",{get:function(){return this.update(),this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),PIXI.InputObject.tabIndex=0,PIXI.InputObject.currentCanvas=null,PIXI.InputObject.currentInput=null,PIXI.InputObject.hiddenInput=null,PIXI.InputObject.inputs=[],PIXI.InputObject.Styles={},PIXI.InputObject.TextCache={},PIXI.InputObject.textProp="value",PIXI.InputObject.Tab=function(t,e,i){if(t.preventDefault(),PIXI.InputObject.inputs.length>1)for(var s=PIXI.InputObject.inputs.indexOf(i);;){if(++s>=PIXI.InputObject.inputs.length&&(s=0),PIXI.InputObject.inputs[s]===i)break
if(-1!==PIXI.InputObject.inputs[s].tabIndex){i.blur(),setTimeout(function(){PIXI.InputObject.inputs[s].focus()},10)
break}}},PIXI.InputObject.Style=function(e,i,s){return i===t?PIXI.InputObject.Styles[e]||{}:(PIXI.InputObject.Styles[e]=i,s&&delete PIXI.InputObject.Styles[e],t)},PIXI.InputObject.blur=function(){PIXI.InputObject.currentInput&&!PIXI.InputObject.currentInput.data.mouseDown&&(PIXI.InputObject.currentInput.blur(),PIXI.InputObject.currentInput=null)},window.addEventListener("blur",PIXI.InputObject.blur,!1),PIXI.InputObject.setCanvas=function(t){p||PIXI.InputObject.currentCanvas!==t&&(PIXI.InputObject.currentCanvas&&(PIXI.InputObject.currentCanvas.removeEventListener("mousedown",PIXI.InputObject.blur,!0),PIXI.InputObject.currentCanvas.removeEventListener("touchstart",PIXI.InputObject.blur,!0)),t&&(t.addEventListener("mousedown",PIXI.InputObject.blur,!0),t.addEventListener("touchstart",PIXI.InputObject.blur,!0)),PIXI.InputObject.currentCanvas=t)},PIXI.InputObject.getTextCache=function(e,i){var s=e.textCache?e.textCache.__id:null,a=e.data.text.font+"_"+e.data.text.strokeThickness
return s&&(--PIXI.InputObject.TextCache[s].count,i)?(PIXI.InputObject.TextCache[s].count<=0&&(PIXI.InputObject.TextCache[s]=null),t):(PIXI.InputObject.TextCache[a]||(PIXI.InputObject.TextCache[a]={count:0,__id:a}),PIXI.InputObject.TextCache[a].count++,PIXI.InputObject.TextCache[a])},PIXI.Input=function(t){this.data=t||{},this.data.style&&(this.data=o(this.data,PIXI.InputObject.Style(this.data.style))),this.data=o(this.data,x),this.data=o(this.data,b),this.data.selection=[0,0],this.data.clipPos=[0,0],this.data.cursorPos=0,this.cursorTimer=0,this.data.value=(this.data.value||this.data.placeholder||"")+"",this.currText=this.data.value,this.data.text.bitmap?(this.text=new PIXI.BitmapText(this.data.value||"Temp",this.data.text),this.text._isBitmapFont=!0,this.text._data=PIXI.BitmapText.fonts[this.text.fontName],this.text._scale=this.text.fontSize/this.text._data.size,this.text._lineHeight=this.text._data.lineHeight*this.text._scale,this.data.value||(this._textNeedsUpdate=!0)):(this.text=new PIXI.Text(this.data.value,this.data.text),this.textCache=PIXI.InputObject.getTextCache(this)),this.cursor=new PIXI.Text("|",this.data.text),this.cursor.visible=!1,this.selection=new PIXI.Sprite(n(this.data.selectionColor)),this.data.height=this.data.height||d(this.text),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=this.data.width,this.canvas.height=this.data.height,PIXI.InputObject.call(this),this.addChild(this.selection),this.addChild(this.text),this.addChild(this.cursor),this.boundOnMouseUp=this.onMouseUp.bind(this),this.boundOnMouseUpOutside=this.onMouseUpOutside.bind(this),this.boundOnMouseDown=this.onMouseDown.bind(this),this.boundOnMouseMove=this.onMouseMove.bind(this),this.interactive=!0,this.defaultCursor="text",this.buttonMode=!0,this.mousemove=this.touchmove=this.boundOnMouseMove,this.mousedown=this.touchstart=this.boundOnMouseDown,this.mouseup=this.touchend=this.boundOnMouseUp,this.mouseupoutside=this.touchendoutside=this.boundOnMouseUpOutside},PIXI.Input.prototype=Object.create(PIXI.InputObject.prototype),PIXI.Input.prototype.constructor=PIXI.Input,o(PIXI.Input.prototype,{focus:function(){if(PIXI.InputObject.prototype.focus.call(this),!this.data.readonly){if(l)return this.value=prompt(this.data.placeholder||"Enter Text",this.value)||this.value,this._textNeedsUpdate=!0,t
this.hiddenInput.type=this.data.type||"text",this.data.maxlength?this.hiddenInput.maxLength=this.data.maxlength:this.hiddenInput.removeAttribute("maxLength"),"number"===this.data.type?(this.data.min!==t&&(this.hiddenInput.min=this.data.min),this.data.max!==t&&(this.hiddenInput.max=this.data.max)):(this.hiddenInput.removeAttribute("min"),this.hiddenInput.removeAttribute("max")),this.currText=this.value,this.data.value=this.currText,s(this.hiddenInput,PIXI.InputObject.textProp,this.currText),this._textNeedsUpdate=!0}},blur:function(t){t=t||this,PIXI.InputObject.prototype.blur.call(t),""===t.data.value&&(t.data.value=t.data.placeholder),t.clearSelection(),this.cursor.visible=!1,t._textNeedsUpdate=!0},onKeyDown:function(e){this.data.selectionStart=-1
{var i=e.which
e.shiftKey}if(27===e.which)return this.blur(),t
if(this._textNeedsUpdate=!0,this._selectionNeedsUpdate=!0,this.data.onkeydown(e,this),65===i&&(e.ctrlKey||e.metaKey))return e.preventDefault(),this.data.selection[0]=0,this.data.selection[1]=this.value.length,this.hiddenInput.selectionStart=0,this.hiddenInput.selectionEnd=this.value.length,t
if(17!==i&&!e.metaKey&&!e.ctrlKey){if(13===i)e.preventDefault(),this.data.onsubmit(e,this)
else if(9===i)return PIXI.InputObject.Tab(e,i,this),t
this.updateTextState()}},onKeyUp:function(t){this.data.onkeyup(t,this),this.updateTextState()},updateTextState:function(){var t=a(this.hiddenInput,PIXI.InputObject.textProp)
t!==this.data.value&&(this.data.value=t,this._textNeedsUpdate=!0),(this.data.selection[0]!==this.hiddenInput.selectionStart||this.data.selection[1]!==this.hiddenInput.selectionEnd)&&(this.data.selection[0]=this.hiddenInput.selectionStart,this.data.selection[1]=this.hiddenInput.selectionEnd,this.data.cursorPos=this.data.selection[0],this._textNeedsUpdate=!0,this._selectionNeedsUpdate=!0,this._cursorNeedsUpdate=!0)},onMouseMove:function(t){if(this.data.hasFocus&&this.data.mouseDown&&!(this.data.selectionStart<0)&&this.stage.interactionManager.hitTest(this,t)){var e=this.mousePos(t),i=this.clickPos(e.x,e.y),s=Math.min(this.data.selectionStart,i),a=Math.max(this.data.selectionStart,i);(this.data.selection[0]!==s||this.data.selection[1]!==a)&&(this.data.selection[0]=s,this.data.selection[1]=a,l||(this.hiddenInput.selectionStart=s,this.hiddenInput.selectionEnd=a),this.data.cursorPos=i,this._textNeedsUpdate=!0,this._selectionNeedsUpdate=!0,this._cursorNeedsUpdate=!0)}},onMouseDown:function(e){if(2===e.originalEvent.which||3===e.originalEvent.which)return e.originalEvent.preventDefault(),t
this.focus()
var i=this.mousePos(e)
this.data.mouseDown=!0,this.data.value===this.data.placeholder&&(this._textNeedsUpdate=!0),this.data.selectionStart=this.clickPos(i.x,i.y),this.data.selection[0]=this.data.selectionStart,this.data.selection[1]=this.data.selectionStart,l||(this.hiddenInput.selectionStart=this.data.selectionStart,this.hiddenInput.selectionEnd=this.data.selectionStart),this.data.cursorPos=this.data.selectionStart,this._cursorNeedsUpdate=!0,this._selectionNeedsUpdate=!0},onMouseUp:function(e){if(2===e.originalEvent.which||3===e.originalEvent.which)return e.originalEvent.preventDefault(),t
var i=this.mousePos(e),s=this.clickPos(i.x,i.y)
this.data.selectionStart>=0&&s!==this.data.selectionStart||(this.data.cursorPos=s,this.data.selection[0]=this.data.cursorPos,this.data.selection[1]=this.data.cursorPos,l||(this.hiddenInput.selectionStart=this.data.cursorPos,this.hiddenInput.selectionEnd=this.data.cursorPos),this._cursorNeedsUpdate=!0),this.data.selectionStart=-1,this.data.mouseDown=!1},update:function(t){(t||this.data.dirty||this._textNeedsUpdate||this._textStyleNeedsUpdate||this._selectionNeedsUpdate)&&(this.data.dirty&&(this.renderTexture(),this.data.dirty=!1),this._textStyleNeedsUpdate&&(this.text.setStyle(this.data.text),this.cursor.setStyle(this.data.text),this.cursor.updateText(),this.text._isBitmapFont?(this.text._data=PIXI.BitmapText.fonts[this.text.fontName],this.text._scale=this.text.fontSize/this.text._data.size,this.text._lineHeight=this.text._data.lineHeight*this.text._scale):this.textCache=PIXI.InputObject.getTextCache(this),this._textStyleNeedsUpdate=!1),this._textNeedsUpdate&&(this.currText=this.clipText(),this.text.setText(this.currText||""),this.text.updateText(),this._textNeedsUpdate=!1),this._selectionNeedsUpdate&&(this.updateSelection(),this._selectionNeedsUpdate=!1))},updateSelection:function(){this.data.selection[0]!==this.data.selection[1]?(this.selection.visible=!0,this.selection.x=this.selection.y+this.textWidth(this.currText.substring(0,this.data.selection[0]-this.data.clipPos[0]))|0,this.selection.width=Math.ceil(this.textWidth(this.currText.substring(this.data.selection[0]-this.data.clipPos[0],this.data.selection[1]-this.data.clipPos[0])))+this.text.style.strokeThickness):this.selection.visible=!1},renderTexture:function(){PIXI.ButtonFactory(this.canvas,this.context,this.data),"none"!==this.data.valign&&this.data.valign?"middle"===this.data.valign?this.text.y=this.data.textboxTop+(this.data.textboxHeight-this.text.height)/2|0:"top"===this.data.valign?this.text.y=0|this.data.textboxTop:"bottom"===this.data.valign&&(this.text.y=this.data.textboxTop+this.data.textboxHeight-this.text.height|0):this.text.y=0|this.data.padding,this.cursor.y=this.text.y,this.data.placeholderAlign=this.data.placeholderAlign||this.data.align,this.text.x=this.data.textboxLeft+this.data.padding|0
var t=this.data.padding+this.data.borderWidth+this.data.shadowTop|0
this.selection.y=t,this.selection.height=this.data.height,this._cursorNeedsUpdate=!0,this._selectionNeedsUpdate=!0,this.updateTexture()},clipText:function(e){var i=e===t,s=0
e=i?this.data.mouseDown||this.data.hasFocus?this.value:this.data.value||this.data.placeholder||"":e,"password"===this.data.type&&e!==this.data.placeholder&&(e=e.replace(/./g,"*"))
var a=this.textWidth(e),h=e.length,n=this.data.width-2*this.data.padding,o=e
if(i&&e!==this.data.placeholder&&(this.data.cursorPos=this.data.cursorPos||0,h<this.data.clipPos[0]&&(this.data.clipPos[0]=0),this.data.cursorPos>this.data.clipPos[1]?(s=this.data.clipPos[0],e=e.substr(s,this.data.cursorPos-this.data.clipPos[0])||""):this.data.cursorPos<this.data.clipPos[0]?(s=this.data.cursorPos,e=e.substr(s)||""):(s=this.data.clipPos[0],e=e.substr(s)),e!==o&&(a=this.textWidth(e),h=e.length)),a>n)if(this.text._isBitmapFont)for(;a>n;)i&&this.data.cursorPos>this.data.clipPos[1]?(a-=this.textWidth(e[0]),e=e.substr(1,--h),s++):(a-=this.textWidth(e[--h]),e=e.substr(0,h))
else for(var d=this.textCache,u="";a>n;)i&&this.data.cursorPos>this.data.clipPos[1]?(u=e[0],d[u]=d[u]||this.textWidth(u),a-=d[u],e=e.substr(1,--h),s++):(u=e[--h],d[u]=d[u]||this.textWidth(u),a-=d[u],e=e.substr(0,h))
return i&&e!==this.data.placeholder&&(this.data.clipPos[0]=s,this.data.clipPos[1]=s+h),e+""},clickPos:function(t){var e=this.currText,i=0,s=e.length
if(t<this.textWidth(e))for(var a=0;a<e.length;a++)if(i+=this.textWidth(e[a]),i>=t){s=a
break}return this.data.clipPos[0]+s},textWidth:function(t){if(this.text._isBitmapFont){for(var e=null,i=0,s=this.text._data,a=0;a<t.length;a++){var h=t.charCodeAt(a),n=s.chars[h]
n&&(e&&n.kerning[e]&&(i+=n.kerning[e]),i+=n.xAdvance,e=h)}return i*this.text._scale}var o=this.context
return o.font=this.text.style.font,o.textAlign="left",o.measureText(t||"").width},mousePos:function(t){return t.getLocalPosition(t.target||this)},clearSelection:function(){this.data.selection[1]!==this.data.selection[0]&&(this.data.cursorPos=0,this.data.selection[0]=0,this.data.selection[1]=0,l||(this.hiddenInput.selectionStart=0,this.hiddenInput.selectionEnd=0),this._cursorNeedsUpdate=!0,this._selectionNeedsUpdate=!0)},updateTransform:function(){if(this.update(),this.data.hasFocus||this.data.mouseDown){var t=Date.now()
t-this.cursorTimer>=I&&(this.cursorTimer=t,this.cursor.visible=!this.cursor.visible),this.selection.visible&&(this.cursor.visible=!1),this.cursor.visible&&this._cursorNeedsUpdate&&(this.cursor.x=this.selection.y-1+this.textWidth(this.currText.substring(0,this.data.cursorPos-this.data.clipPos[0]))|0,this._cursorNeedsUpdate=!1)}else this.selection.visible=!1,this.cursor.visible=!1
PIXI.Sprite.prototype.updateTransform.call(this)},destroy:function(){this.text._isBitmapFont?this.text=null:(PIXI.InputObject.getTextCache(this,!0),this.text.destroy(!0)),this.cursor.destroy(!0),PIXI.InputObject.prototype.destroy.call(this)}},!0),Object.defineProperty(PIXI.Input.prototype,"value",{get:function(){return this.data.value===this.data.placeholder?"":this.data.value},set:function(t){this.data.value=t+"",s(this.hiddenInput,PIXI.InputObject.textProp,t+""),this._textNeedsUpdate=!0}}),PIXI.Button=function(t){this.tabIndex=-1,this.data=t||{},this.data.style&&(this.data=o(this.data,PIXI.InputObject.Style(this.data.style))),this.data=o(this.data,x),this.data=o(this.data,b),this.data.text.bitmap?(this.text=new PIXI.BitmapText(this.data.value||"Temp",this.data.text),this.text._isBitmapFont=!0,this.text._data=PIXI.BitmapText.fonts[this.text.fontName],this.text._scale=this.text.fontSize/this.text._data.size,this.text._lineHeight=this.text._data.lineHeight*this.text._scale,this.data.value||(this._textNeedsUpdate=!0)):this.text=new PIXI.Text(this.data.value,this.data.text),this.data.height=this.data.height||d(this.text),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=this.data.width,this.canvas.height=this.data.height,PIXI.InputObject.call(this,-1),this.addChild(this.text),this.boundOnMouseUp=this.onMouseUp.bind(this),this.boundOnMouseUpOutside=this.onMouseUpOutside.bind(this),this.boundOnMouseDown=this.onMouseDown.bind(this),this.interactive=!0,this.buttonMode=!0,this.mousedown=this.touchstart=this.boundOnMouseDown,this.mouseup=this.touchend=this.boundOnMouseUp,this.mouseupoutside=this.touchendoutside=this.boundOnMouseUpOutside},PIXI.Button.prototype=Object.create(PIXI.InputObject.prototype),PIXI.Button.prototype.constructor=PIXI.Button,o(PIXI.Button.prototype,{focus:function(){PIXI.InputObject.prototype.focus.call(this)},blur:function(t){PIXI.InputObject.prototype.blur.call(t||this)},onMouseDown:function(t){this.focus(),this.data.mouseDown=!0,this.data.onmousedown(t,this)},onMouseUp:function(t){this.data.onmouseup(t,this),this.data.mouseDown=!1},update:function(t){(t||this.data.dirty||this._textNeedsUpdate||this._textStyleNeedsUpdate)&&(this.data.dirty&&(this.renderTexture(),this.data.dirty=!1),this._textStyleNeedsUpdate&&(this.text.setStyle(this.data.text),this.text._isBitmapFont&&(this.text._data=PIXI.BitmapText.fonts[this.text.fontName],this.text._scale=this.text.fontSize/this.text._data.size,this.text._lineHeight=this.text._data.lineHeight*this.text._scale),this._textStyleNeedsUpdate=!1),this._textNeedsUpdate&&(this.text.setText(this.data.value||""),this.text.updateText(),"center"===this.data.align?this.text.x=(this.data.outerWidth-this.text.width)/2|0:"right"===this.data.align&&(this.text.x=this.data.outerWidth-this.text.width-this.data.textboxLeft-this.data.padding|0),this._textNeedsUpdate=!1))},renderTexture:function(){PIXI.ButtonFactory(this.canvas,this.context,this.data),"none"!==this.data.valign&&this.data.valign?"middle"===this.data.valign?this.text.y=this.data.textboxTop+(this.data.textboxHeight-this.text.height)/2|0:"top"===this.data.valign?this.text.y=0|this.data.textboxTop:"bottom"===this.data.valign&&(this.text.y=this.data.textboxTop+this.data.textboxHeight-this.text.height|0):this.text.y=0|this.data.padding,this.text.x=this.data.textboxLeft+this.data.padding|0,this.updateTexture()},updateTransform:function(){this.update(),PIXI.Sprite.prototype.updateTransform.call(this)},destroy:function(){this.text._isBitmapFont?this.text.destroy(!0):this.text=null,PIXI.InputObject.prototype.destroy.call(this)}},!0),Object.defineProperty(PIXI.Button.prototype,"value",{get:function(){return this.data.value},set:function(t){this.data.value=t+"",this._textNeedsUpdate=!0}}),PIXI.Select=function(e){this.data=e||{},this.data.style&&(this.data=o(this.data,PIXI.InputObject.Style(this.data.style))),this.data=o(this.data,x),this.data=o(this.data,b),this.data.options=this.data.options||{},this.data.selected=this.data.selected||null,this.selectedIndex=0,this.lineHeight=20,this.options=[],this.data.text.bitmap?(this.text=new PIXI.BitmapText("Temp",this.data.text),this.text._isBitmapFont=!0,this.text._data=PIXI.BitmapText.fonts[this.text.fontName],this.text._scale=this.text.fontSize/this.text._data.size,this.text._lineHeight=this.text._data.lineHeight*this.text._scale):this.text=new PIXI.Text("",this.data.text),this.selection=new PIXI.Sprite(n(this.data.selectionColor)),this.selection.visible=!1,this.menu=new PIXI.Sprite(n(this.data.backgroundColor)),this.menu.visible=!1,this.data.height=this.data.height||d(this.text),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=this.data.width,this.canvas.height=this.data.height,PIXI.InputObject.call(this),this.addChild(this.text),this.addChild(this.menu),this.addChild(this.selection),this.boundOnMouseUp=this.onMouseUp.bind(this),this.boundOnMouseUpOutside=this.onMouseUpOutside.bind(this),this.boundOnMouseDown=this.onMouseDown.bind(this),this.interactive=!0,this.mousedown=this.touchstart=this.boundOnMouseDown,this.mouseup=this.touchend=this.boundOnMouseUp,this.mouseupoutside=this.touchendoutside=this.boundOnMouseUpOutside
var i=""
for(var s in this.data.options)this.data.selected===s&&(this.selectedIndex=this.options.length),this.options.push({value:s,text:this.data.options[s]}),i+=this.data.options[s]+"\n"
this.data.optionText&&this.data.optionText.bitmap?(this.optionstext=new PIXI.BitmapText(i,this.data.optionText),this.optionstext._isBitmapFont=!0,this.optionstext._data=PIXI.BitmapText.fonts[this.optionstext.fontName],this.optionstext._scale=this.optionstext.fontSize/this.optionstext._data.size,this.optionstext._lineHeight=this.optionstext._data.lineHeight*this.optionstext._scale,this.lineHeight=this.optionstext._lineHeight):(this.optionstext=new PIXI.Text(i,this.data.optionText||{font:"14px arial"}),this.lineHeight=this.optionstext.height/(this.options.length+1)-this.optionstext.style.strokeThickness/2|0),this.optionstext.visible=!1,this.addChild(this.optionstext),this.menu.height=this.lineHeight*this.options.length-1,this.menu.interactive=!0,this.menu.mousedown=this.menu.touchstart=function(e){return 2===e.originalEvent.which||3===e.originalEvent.which?(e.originalEvent.preventDefault(),this.displayMenu(!1),t):(this.selectedIndex=this.getIndexByLocalPosition(e),this.updateText(),t)}.bind(this),this.menu.mousemove=this.menu.touchmove=function(t){this.menu.stage&&this.menu.stage.interactionManager.hitTest(this.menu,t)&&(this.menu.selectedIndex=this.getIndexByLocalPosition(t),this.updateSelection(this.menu.selectedIndex))}.bind(this),this.updateText()},PIXI.Select.prototype=Object.create(PIXI.InputObject.prototype),PIXI.Select.prototype.constructor=PIXI.Select,o(PIXI.Select.prototype,{getIndexByLocalPosition:function(t){var e=t.getLocalPosition(this).y-this.menu.startY
if(!(1>e||e>this.menu.height)){var i=Math.floor(e/(this.lineHeight+1))
return 0>i?i=0:i>=this.options.length&&(i=this.options.length-1),i}},updateText:function(){var t=this.value
t?(this.data.value!==t.text&&(this.data.value=t.text),this._textNeedsUpdate=!0,this.updateSelection()):this.data.value=""},updateSelection:function(e){this.selection.y=this.menu.startY+this.lineHeight*(e!==t?e:this.selectedIndex)},focus:function(){PIXI.InputObject.prototype.focus.call(this)},blur:function(t){t=t||this,PIXI.InputObject.prototype.blur.call(t),t.displayMenu(!1)},onKeyDown:function(e){{var i=e.which
e.shiftKey}return 27===e.which?(this.blur(),t):(this._textNeedsUpdate=!0,this._selectionNeedsUpdate=!0,this.data.onkeydown(e,this),32===i||13===i?(e.preventDefault(),this.menu.visible?(this.displayMenu(!1),this.menu.selectedIndex&&(this.selectedIndex=this.menu.selectedIndex,this.menu.selectedIndex=null,this.updateText())):this.displayMenu(!0),t):9===i?(PIXI.InputObject.Tab(e,i,this),t):(38===i&&(this.selectedIndex--,this.selectedIndex<0&&(this.selectedIndex=0),this.updateText()),40===i&&(this.selectedIndex++,this.selectedIndex>=this.options.length&&(this.selectedIndex=this.options.length-1),this.updateText()),t))},onKeyUp:function(t){this.data.onkeyup(t,this),this.menu.selectedIndex||this.updateText()},onMouseDown:function(t){this.focus(),this.data.mouseDown=!0,this.data.onmousedown(t,this)},onMouseUp:function(t){this.data.onmouseup(t,this),this.data.mouseDown=!1,this.focus(),this.displayMenu(!this.menu.visible)},displayMenu:function(t){if(this.menu.visible=t,this.selection.visible=!1,this.optionstext.visible=!1,t){this.menu.x=this.data.textboxLeft,this.menu.width=this.data.textboxWidth,this.selection.x=this.data.textboxLeft,this.selection.width=this.data.textboxWidth,this.selection.height=this.lineHeight
var e=this.stage?this.stage.interactionManager.target.height:0,i=this.y-this.height*this.anchor.y,s=e-(i+this.height)
this.menu.height>s&&i>s?(this.menu.anchor.y=1,this.menu.y=1):(this.menu.anchor.y=0,this.menu.y=this.height-1),this.menu.startY=this.menu.y-this.menu.height*this.menu.anchor.y,this.menu.selectedIndex=null,this.optionstext.y=this.menu.startY,this.optionstext.x=5,this.optionstext.visible=!0,this.value&&(this.selection.visible=!0,this.updateSelection())}},update:function(t){(t||this.data.dirty||this._textNeedsUpdate||this._textStyleNeedsUpdate)&&(this.data.dirty&&(this.renderTexture(),this.data.dirty=!1),this._textStyleNeedsUpdate&&(this.text.setStyle(this.data.text),this.text._isBitmapFont&&(this.text._data=PIXI.BitmapText.fonts[this.text.fontName],this.text._scale=this.text.fontSize/this.text._data.size,this.text._lineHeight=this.text._data.lineHeight*this.text._scale),this._textStyleNeedsUpdate=!1),this._textNeedsUpdate&&(this.text.setText(this.data.value||""),this.text.updateText(),this._textNeedsUpdate=!1))},renderTexture:function(){PIXI.ButtonFactory(this.canvas,this.context,this.data),PIXI.ButtonFactory(v,m,{backgroundGradient:["#bbb","#eee","#bbb"],borderWidth:1,borderColor:this.data.borderColor,borderRadius:[0,this.data.borderRadius,this.data.borderRadius,0],boxShadow:"none",innerShadow:"none",padding:0,width:25,height:this.data.outerHeight}),m.beginPath(),m.moveTo(9+this.data.borderWidth-2,this.data.outerHeight/3+this.data.borderWidth+1),m.lineTo(17-this.data.borderWidth,this.data.outerHeight/3+this.data.borderWidth+1),m.lineTo(12,2*this.data.outerHeight/3-this.data.borderWidth+2),m.closePath(),m.fillStyle="#000",m.fill(),this.context.drawImage(v,0,0,25,this.data.outerHeight,this.data.outerWidth-25,0,25,this.data.outerHeight),"none"!==this.data.valign&&this.data.valign?"middle"===this.data.valign?this.text.y=this.data.textboxTop+(this.data.textboxHeight-this.text.height)/2|0:"top"===this.data.valign?this.text.y=0|this.data.textboxTop:"bottom"===this.data.valign&&(this.text.y=this.data.textboxTop+this.data.textboxHeight-this.text.height|0):this.text.y=0|this.data.padding,this.text.x=this.data.textboxLeft+this.data.padding|0,this.updateTexture()},updateTransform:function(){this.update(),PIXI.Sprite.prototype.updateTransform.call(this)},destroy:function(){this.text._isBitmapFont?this.text=null:this.text.destroy(!0),this.optionstext._isBitmapFont?this.optionstext=null:this.optionstext._isBitmapFont.destroy(!0),PIXI.InputObject.prototype.destroy.call(this)}},!0),Object.defineProperty(PIXI.Select.prototype,"value",{get:function(){return this.options[this.selectedIndex]?this.options[this.selectedIndex]:null},set:function(){}})}()
